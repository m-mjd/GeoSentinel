name: Manual Build and Release

on:
  workflow_dispatch:
    inputs:
      tag_name:
        description: "Tag to create (e.g. v1.0.0)"
        required: true
        type: string

      release_name:
        description: "Release display name (optional)"
        required: false
        default: ""
        type: string

      overwrite_release:
        description: "If true, delete existing release with the same tag before creating (CAREFUL)"
        required: false
        default: "true"
        type: string

      draft:
        description: "Create release as draft? (true/false)"
        required: false
        default: "false"
        type: string

      prerelease:
        description: "Create release as prerelease? (true/false)"
        required: false
        default: "false"
        type: string

      app_name:
        description: "Output app name (filename will be sanitized)"
        required: false
        default: "Geosentinel"
        type: string

      main_py_file:
        description: "Entrypoint python file"
        required: false
        default: "app.py"
        type: string

      requirements_file:
        description: "Requirements file"
        required: false
        default: "requirements.txt"
        type: string

      python_version:
        description: "Python version"
        required: false
        default: "3.10"
        type: string

permissions:
  contents: write

jobs:
  build_and_release:
    uses: ./.github/workflows/reusable-build-release.yml
    with:
      tag_name: ${{ inputs.tag_name }}
      release_name: ${{ inputs.release_name }}
      overwrite_release: ${{ inputs.overwrite_release }}
      draft: ${{ inputs.draft }}
      prerelease: ${{ inputs.prerelease }}
      app_name: ${{ inputs.app_name }}
      main_py_file: ${{ inputs.main_py_file }}
      requirements_file: ${{ inputs.requirements_file }}
      python_version: ${{ inputs.python_version }}
    secrets: inherit
